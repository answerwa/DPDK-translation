**第一部分：架构概述**

# 2. 概述

本节将全面介绍 Data Plane Development Kit（DPDK）的架构。

DPDK的主要目标是为数据平面应用程序中的数据包快速处理提供一个简单，完整的框架。用户可以使用代码来了解所采用的一些技术，以便进行原型开发或添加自己的协议栈。 通过系统选项使用DPDK是可行的。

该框架通过创建 Environment Abstraction Layer（EAL）为特定环境创建一组库，该抽象层可能特定于Intel®架构（32位或64位），Linux *用户空间编译器或一个指定的平台。 这些环境是通过使用makefile和配置文件创建的。 创建EAL库后，用户可以链接库来创建自己的应用程序。 还提供了EAL之外的其他库，包括哈希，Longest Prefix Match（LPM）和环库。 提供了示例应用程序，以帮助用户展示如何使用DPDK的各种功能。

DPDK实现了一个运行到完成（run to completion）的模型完成对数据包的处理，其中所有资源必须在调用Data Plane应用程序之前分配，作为逻辑处理核心上的执行单元运行。该模型不支持调度程序，所有设备都可以通过轮询进行访问。不使用中断的主要原因是中断处理所带来的性能开销。

除了run-to-completion模型，还可以通过环完成核心之间数据包或消息的传递来使用管道（pipeline）模型。这允许分阶段执行工作，并可以更有效地使用内核上的代码。

## 2.1. 开发环境

DPDK 项目安装需要 Linux 和相关联的工具链，例如一个或多个编译器，汇编器，make实用程序，编辑器和各种库来创建 DPDK 组件和库。

一旦为特定的环境和架构创建了这些库，就可以使用它们来创建用户的数据平面应用程序。

当为Linux用户空间创建应用程序时，将使用glibc库。对于 DPDK 应用程序，必须在编译应用程序之前配置两个环境变量（RTE_SDK 和 RTE_TARGET）。以下是如何设置变量的示例：

```sh
export RTE_SDK=/home/user/DPDK
export RTE_TARGET=x86_64-native-linuxapp-gcc
```

有关设置开发环境的信息，请参阅”DPDK入门指南”。

## 2.2. 环境抽象层

环境抽象层（EAL）提供了一个通用接口，可以隐藏应用程序和库的环境细节。 EAL 提供的服务包括：

- DPDK 的加载和启动
- 支持多进程和多线程的执行
- 内核关联/分配程序
- 系统内存分配/释放
- 原子/锁定操作
- 时间调用
- PCI 总线访问
- 跟踪和调试函数
- CPU 功能识别
- 中断处理
- 报警操作
- 内存管理（malloc）

EAL 的完整描述，请参考[环境抽象层](https://github.com/answerwa/DPDK-translation/blob/master/程序员指南/3.%20环境抽象层.md)。

## 2.3. Core Components

The *core components* are a set of libraries that provide all the elements needed for high-performance packet processing applications.

![](http://dpdk.org/doc/guides/_images/architecture-overview.svg)

Fig. 2.1 Core Components Architecture

### 2.3.1. Ring Manager (librte_ring)

The ring structure provides a lockless multi-producer, multi-consumer FIFO API in a finite size table. It has some advantages over lockless queues; easier to implement, adapted to bulk operations and faster. A ring is used by the [Memory Pool Manager (librte_mempool)](http://dpdk.org/doc/guides/prog_guide/mempool_lib.html#mempool-library) and may be used as a general communication mechanism between cores and/or execution blocks connected together on a logical core.

This ring buffer and its usage are fully described in [Ring Library](http://dpdk.org/doc/guides/prog_guide/ring_lib.html#ring-library).

### 2.3.2. Memory Pool Manager (librte_mempool)

The Memory Pool Manager is responsible for allocating pools of objects in memory. A pool is identified by name and uses a ring to store free objects. It provides some other optional services, such as a per-core object cache and an alignment helper to ensure that objects are padded to spread them equally on all RAM channels.

This memory pool allocator is described in [Mempool Library](http://dpdk.org/doc/guides/prog_guide/mempool_lib.html#mempool-library).

### 2.3.3. Network Packet Buffer Management (librte_mbuf)

The mbuf library provides the facility to create and destroy buffers that may be used by the DPDK application to store message buffers. The message buffers are created at startup time and stored in a mempool, using the DPDK mempool library.

This library provides an API to allocate/free mbufs, manipulate control message buffers (ctrlmbuf) which are generic message buffers, and packet buffers (pktmbuf) which are used to carry network packets.

Network Packet Buffer Management is described in [Mbuf Library](http://dpdk.org/doc/guides/prog_guide/mbuf_lib.html#mbuf-library).

### 2.3.4. Timer Manager (librte_timer)

This library provides a timer service to DPDK execution units, providing the ability to execute a function asynchronously. It can be periodic function calls, or just a one-shot call. It uses the timer interface provided by the Environment Abstraction Layer (EAL) to get a precise time reference and can be initiated on a per-core basis as required.

The library documentation is available in [Timer Library](http://dpdk.org/doc/guides/prog_guide/timer_lib.html#timer-library).

## 2.4. Ethernet* Poll Mode Driver Architecture

The DPDK includes Poll Mode Drivers (PMDs) for 1 GbE, 10 GbE and 40GbE, and para virtualized virtio Ethernet controllers which are designed to work without asynchronous, interrupt-based signaling mechanisms.

See [Poll Mode Driver](http://dpdk.org/doc/guides/prog_guide/poll_mode_drv.html#poll-mode-driver).

## 2.5. Packet Forwarding Algorithm Support

The DPDK includes Hash (librte_hash) and Longest Prefix Match (LPM,librte_lpm) libraries to support the corresponding packet forwarding algorithms.

See [Hash Library](http://dpdk.org/doc/guides/prog_guide/hash_lib.html#hash-library) and [LPM Library](http://dpdk.org/doc/guides/prog_guide/lpm_lib.html#lpm-library) for more information.

## 2.6. librte_net

The librte_net library is a collection of IP protocol definitions and convenience macros. It is based on code from the FreeBSD* IP stack and contains protocol numbers (for use in IP headers), IP-related macros, IPv4/IPv6 header structures and TCP, UDP and SCTP header structures.